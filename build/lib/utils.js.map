{
  "version": 3,
  "sources": ["../../src/lib/utils.ts"],
  "sourcesContent": ["// utils.ts\n\ntype TranslatedName = string | { en: string; [key: string]: string };\n\nexport interface CreateStructuredStateOptions {\n\tdeviceName?: TranslatedName;\n\tchannelId?: string;\n\tchannelName?: TranslatedName;\n\tstateName?: TranslatedName;\n\trole?: string;\n\ttype?: string;\n\tunit?: string;\n}\n\nexport interface CreateStructuredWritableOptions {\n\tdeviceName?: TranslatedName;\n\tchannelId?: string;\n\tchannelName?: TranslatedName;\n\tstateName?: TranslatedName;\n\trole?: string;\n\ttype?: ioBroker.CommonType;\n\tunit?: string;\n\tq?: number;\n}\n\n/**\n * Sanitize a string to create a valid ID.\n *\n * @param name The input string to sanitize.\n * @returns The sanitized string.\n */\nexport function sanitizeId(name: string): string {\n\treturn name\n\t\t.normalize('NFD')\n\t\t.replace(/[\\u0300-\\u036f]/g, '')\n\t\t.replace(/[^\\w\\d-_]/g, '_')\n\t\t.replace(/_+/g, '_')\n\t\t.replace(/^_+|_+$/g, '')\n\t\t.toLowerCase();\n}\n\n/**\n * Ensures that a translated name is returned in a consistent format.\n *\n * @param name The input name to ensure.\n * @param fallback A fallback name to use if the input is not valid.\n * @returns The ensured translated name.\n */\nexport function ensureTranslatedName(\n\tname?: string | { [lang: string]: string },\n\tfallback?: string,\n): string | { [lang: string]: string; en: string } {\n\tif (!name && fallback) {\n\t\treturn fallback;\n\t}\n\n\tif (typeof name === 'string') {\n\t\treturn name;\n\t}\n\n\tif (typeof name === 'object') {\n\t\t// Stelle sicher, dass 'en' gesetzt ist \u2013 ggf. mit fallback\n\t\treturn {\n\t\t\t...name,\n\t\t\ten: name.en ?? fallback ?? 'unknown',\n\t\t};\n\t}\n\n\treturn fallback ?? 'unknown';\n}\n\n/**\n * \uD83D\uDD27 Creates a structured writable state in the ioBroker.\n *\n * @param adapter The ioBroker adapter instance.\n * @param deviceId The ID of the device.\n * @param stateId The ID of the state.\n * @param value The value to set for the state.\n * @param options Options for creating the structured writable state.\n */\nexport async function createStructuredWritableState(\n\tadapter: ioBroker.Adapter,\n\tdeviceId: string,\n\tstateId: string,\n\tvalue: ioBroker.StateValue,\n\toptions?: CreateStructuredWritableOptions,\n): Promise<void> {\n\tconst {\n\t\tdeviceName,\n\t\tchannelId,\n\t\tchannelName,\n\t\tstateName,\n\t\trole = 'state',\n\t\ttype = typeof value as ioBroker.CommonType,\n\t\tunit,\n\t\tq,\n\t} = options ?? {};\n\n\tconst devicePath = deviceId;\n\tconst channelPath = channelId ? `${devicePath}.${channelId}` : undefined;\n\tconst statePath = channelPath ? `${channelPath}.${stateId}` : `${devicePath}.${stateId}`;\n\n\t// Device\n\tawait adapter.setObjectNotExistsAsync(devicePath, {\n\t\ttype: 'device',\n\t\tcommon: {\n\t\t\tname: ensureTranslatedName(deviceName, deviceId),\n\t\t},\n\t\tnative: {},\n\t});\n\n\t// Channel (optional)\n\tif (channelPath) {\n\t\tawait adapter.setObjectNotExistsAsync(channelPath, {\n\t\t\ttype: 'channel',\n\t\t\tcommon: {\n\t\t\t\tname: ensureTranslatedName(channelName, channelId), //!\n\t\t\t},\n\t\t\tnative: {},\n\t\t});\n\t}\n\n\t// State (writeable)\n\tawait adapter.setObjectNotExistsAsync(statePath, {\n\t\ttype: 'state',\n\t\tcommon: {\n\t\t\tname: ensureTranslatedName(stateName, stateId),\n\t\t\trole,\n\t\t\ttype,\n\t\t\tunit,\n\t\t\tread: true,\n\t\t\twrite: true,\n\t\t},\n\t\tnative: {},\n\t});\n\t//await adapter.setState(statePath, { val: value, ack: false, q: q !== undefined ? q : undefined } as ioBroker.State);\n\n\tconst state: Pick<ioBroker.State, 'val' | 'ack'> & Partial<Pick<ioBroker.State, 'q'>> = {\n\t\tval: value,\n\t\tack: false,\n\t};\n\n\tif (q !== undefined) {\n\t\tstate.q = q as ioBroker.State['q'];\n\t}\n\n\tawait adapter.setState(statePath, state);\n}\n\n/**\n * \uD83D\uDD27 Creates a device in the ioBroker.\n *\n * @param adapter The ioBroker adapter instance.\n * @param deviceId The ID of the device.\n * @param name The name of the device.\n * @returns The ID of the created device.\n */\nexport async function createDevice(\n\tadapter: ioBroker.Adapter,\n\tdeviceId: string,\n\tname?: string | { [lang: string]: string },\n): Promise<string> {\n\tconst id = sanitizeId(deviceId);\n\tawait adapter.setObjectNotExistsAsync(id, {\n\t\ttype: 'device',\n\t\tcommon: {\n\t\t\tname: ensureTranslatedName(name, id),\n\t\t},\n\t\tnative: {},\n\t});\n\treturn id;\n}\n\n/**\n * \uD83D\uDD27 Creates a channel in the ioBroker.\n *\n * @param adapter The ioBroker adapter instance.\n * @param deviceId The ID of the device.\n * @param channelId The ID of the channel.\n * @param name The name of the channel.\n * @returns The ID of the created channel.\n */\nexport async function createChannel(\n\tadapter: ioBroker.Adapter,\n\tdeviceId: string,\n\tchannelId: string,\n\tname?: string | { [lang: string]: string },\n): Promise<string> {\n\tconst devId = sanitizeId(deviceId);\n\tconst chId = sanitizeId(channelId);\n\tconst fullId = `${devId}.${chId}`;\n\tawait adapter.setObjectNotExistsAsync(fullId, {\n\t\ttype: 'channel',\n\t\tcommon: {\n\t\t\tname: ensureTranslatedName(name, chId),\n\t\t},\n\t\tnative: {},\n\t});\n\treturn fullId;\n}\n\n/**\n * \uD83D\uDD27 Creates a folder in the ioBroker.\n *\n * @param adapter The ioBroker adapter instance.\n * @param deviceId The ID of the device.\n * @param folderId The ID of the folder.\n * @param name The name of the folder.\n * @returns The ID of the created folder.\n */\nexport async function createFolder(\n\tadapter: ioBroker.Adapter,\n\tdeviceId: string,\n\tfolderId: string,\n\tname?: string | { [lang: string]: string },\n): Promise<string> {\n\tconst devId = sanitizeId(deviceId);\n\tconst fId = sanitizeId(folderId);\n\tconst fullId = `${devId}.${fId}`;\n\tawait adapter.setObjectNotExistsAsync(fullId, {\n\t\ttype: 'folder',\n\t\tcommon: {\n\t\t\tname: ensureTranslatedName(name, fId),\n\t\t},\n\t\tnative: {},\n\t});\n\treturn fullId;\n}\n\n/**\n * \uD83D\uDD27 Creates a writable state in the ioBroker.\n *\n * @param adapter The ioBroker adapter instance.\n * @param fullPath The full path of the state (e.g., \"device.channel.state\").\n * @param stateId The ID of the state.\n * @param value The initial value of the state.\n * @param options Options for creating the writable state.\n * @param options.name optional name for the state\n * @param options.role optional role for the state\n * @param options.type optional type for the state\n * @param options.unit optional unit for the state\n * @param options.q optional quality for the state\n */\nexport async function createWritableState(\n\tadapter: ioBroker.Adapter,\n\tfullPath: string, //z.B. \"device.channel.state\"\n\tstateId: string,\n\tvalue: ioBroker.StateValue,\n\toptions?: {\n\t\tname?: string | { [lang: string]: string };\n\t\trole?: string;\n\t\ttype?: ioBroker.CommonType;\n\t\tunit?: string;\n\t\tq?: ioBroker.State['q'];\n\t},\n): Promise<void> {\n\tconst { name, role = 'state', type = typeof value as ioBroker.CommonType, unit, q } = options ?? {};\n\n\tconst stId = sanitizeId(stateId);\n\tconst fullStatePath = `${fullPath}.${stId}`;\n\n\tawait adapter.setObjectNotExistsAsync(fullStatePath, {\n\t\ttype: 'state',\n\t\tcommon: {\n\t\t\tname: ensureTranslatedName(name, stId),\n\t\t\trole,\n\t\t\ttype,\n\t\t\tunit,\n\t\t\tread: true,\n\t\t\twrite: true,\n\t\t},\n\t\tnative: {},\n\t});\n\n\tconst state: Pick<ioBroker.State, 'val' | 'ack'> & Partial<Pick<ioBroker.State, 'q'>> = {\n\t\tval: value,\n\t\tack: false,\n\t};\n\n\tif (q !== undefined) {\n\t\tstate.q = q as ioBroker.State['q'];\n\t}\n\n\tawait adapter.setState(fullStatePath, state);\n}\n\n/**\n * \uD83D\uDD27 Creates a state in the ioBroker.\n *\n * @param adapter The ioBroker adapter instance.\n * @param fullPath The full path of the state (e.g., \"device.channel.state\").\n * @param stateId The ID of the state.\n * @param value The initial value of the state.\n * @param options Options for creating the state.\n * @param options.name optional name for the state\n * @param options.role optional role for the state\n * @param options.type optional type for the state\n * @param options.unit optional unit for the state\n * @param options.q optional quality for the state\n */\nexport async function createState(\n\tadapter: ioBroker.Adapter,\n\tfullPath: string, // z.B. \"device.channel.state\"\n\tstateId: string,\n\tvalue: ioBroker.StateValue,\n\toptions?: {\n\t\tname?: string | { [lang: string]: string };\n\t\trole?: string;\n\t\ttype?: ioBroker.CommonType;\n\t\tunit?: string;\n\t\tq?: ioBroker.State['q'];\n\t},\n): Promise<void> {\n\tconst { name, role = 'state', type = typeof value as ioBroker.CommonType, unit, q } = options ?? {};\n\n\tconst stId = sanitizeId(stateId);\n\tconst fullStatePath = `${fullPath}.${stId}`;\n\n\tawait adapter.setObjectNotExistsAsync(fullStatePath, {\n\t\ttype: 'state',\n\t\tcommon: {\n\t\t\tname: ensureTranslatedName(name, stId),\n\t\t\trole,\n\t\t\ttype,\n\t\t\tunit,\n\t\t\tread: true,\n\t\t\twrite: false,\n\t\t},\n\t\tnative: {},\n\t});\n\n\tconst state: Pick<ioBroker.State, 'val' | 'ack'> & Partial<Pick<ioBroker.State, 'q'>> = {\n\t\tval: value,\n\t\tack: true,\n\t};\n\n\tif (q !== undefined) {\n\t\tstate.q = q as ioBroker.State['q'];\n\t}\n\n\tawait adapter.setState(fullStatePath, state);\n}\n"],
  "mappings": "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",
  "names": []
}
